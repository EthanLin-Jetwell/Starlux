@RestResource(urlMapping = '/receive-response/cancel-pnr')
global class ReceiveResponseCancelPnrApi {
    
    @HttpPost
    global static void cancelPnr() {
        RestRequest request = RestContext.request;
        RestResponse response = Restcontext.response;

        ReceiveResponseCancelPnrWrapper wrapper = ReceiveResponseCancelPnrWrapper.deserializeJson(request.requestBody.toString());

        if (wrapper.isMissingRequiredFields()) {
            response = ResponseUtil.buildErrorRestResponse(response, Constants.MISSING_REQUIRED_FIELD);
            ApiLogger.log(request, response);
            return;
        }

        Seat_Allocation_and_Ticketing__c sat = [SELECT Id, Sync_SAT_Status__c, Sync_SAT_Error_Message__c, Booking_Reference_PNR__c, Case_ID__c FROM Seat_Allocation_and_Ticketing__c WHERE Name =: wrapper.sat_no];
        Seat_Allocation_and_Ticketing__c masterSat = [SELECT Id, Name FROM Seat_Allocation_and_Ticketing__c WHERE Case_ID__c =: sat.Case_ID__c AND Booking_Reference_PNR__c =: sat.Booking_Reference_PNR__c AND (Allocation_Type__c =: Constants.PICKLIST_SAT_ALLOCATION_TYPE_ADC OR Allocation_Type__c =: Constants.PICKLIST_SAT_ALLOCATION_TYPE_SRS) LIMIT 1];
        sat.Sync_SAT_Status__c = wrapper.status;
        sat.Sync_SAT_Error_Message__c = '';
        if (wrapper.status == Constants.PICKLIST_STATUS_FAIL) {
            sat.Sync_SAT_Error_Message__c = wrapper.error_message;
        }
        /*if (wrapper.status == Constants.PICKLIST_STATUS_SUCCEEDED) {
            Map<String,String> whereCriterias = new Map<String,String> {'Id' => sat.Case_ID__c};
            List<Case> currCaseList = DbUtil.queryAllFieldsWithWhere('Case', whereCriterias);
            if (!currCaseList.isEmpty() && currCaseList.get(0).SST_Mark__c == masterSat.Name ) {
                currCaseList.get(0).SST_Mark__c = '';
                currCaseList.get(0).Sync_SST_Status__c = '';
                Database.update(currCaseList.get(0));
                CaseUtil.syncSst(currCaseList);  
            }
        }  */ //20250520 Eli: canceled due to it's a legacy CGRP function

        Database.update(sat);
        
        response = ResponseUtil.buildSuccessRestResponse(response);
        
        ApiLogger.log(request, response);
    }

    public static void fakeMethod(){
        Integer i = 0;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
    }
}